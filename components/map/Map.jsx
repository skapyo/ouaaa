import React, { useRef, useState, useEffect } from 'react';
import makeStyles from '@mui/styles/makeStyles';
import {
  MapContainer, TileLayer, Marker, Popup, Tooltip, ZoomControl,Polygon
} from 'react-leaflet';
import L from 'leaflet';
import 'leaflet.markercluster';
import 'leaflet/dist/leaflet.css';

L.Icon.Default.mergeOptions({
  iconUrl: null,
});


const useStyles = makeStyles((theme) => ({
  mapContainer: {
    height: '100% !important',
    [theme.breakpoints.down('md')]: {
      height: '63vh !important',
    },
  },
  polygon:{
    cursor: 'grab',
  }
}));

const Map = (props) => {
  const mapRef = useRef();
  const styles = useStyles();
  const [map, setMap] = useState(null);
  let { children,position } = props;
  if (typeof position === 'undefined'){
    position = [46.1085193, -0.9864794];
  }

  useEffect(() => {
    if (map) {
      setInterval(() => {
        try {
          if (map) {
            map.invalidateSize();
          }
        } catch (error) {
        }
      }, 100);
    }
  }, [map]);
  const re = [{ lat: 46.162526438537185 , lon: -1.2535035610198975 } ,{ lat: 46.143975651642066 , lon: -1.2792527675628664 } ,{ lat: 46.145878584231475 , lon: -1.3235414028167727 } ,{ lat: 46.16419094698245 , lon: -1.3671433925628662 } ,{ lat: 46.198473072586715 , lon: -1.4557528495788576 } ,{ lat: 46.20132461984211 , lon: -1.4852786064147951 } ,{ lat: 46.192769534102744 , lon: -1.5038180351257326 } ,{ lat: 46.202750337973434 , lon: -1.5360903739929201 } ,{ lat: 46.245504678433946 , lon: -1.5635561943054201 } ,{ lat: 46.2450298131309 , lon: -1.5402102470397951 } ,{ lat: 46.257849733512 , lon: -1.5134310722351076 } ,{ lat: 46.256900212543066 , lon: -1.4921450614929201 } ,{ lat: 46.246454396708316 , lon: -1.479785442352295 } ,{ lat: 46.23410677663698 , lon: -1.4722323417663574 } ,{ lat: 46.22793192455733 , lon: -1.4852786064147951 } ,{ lat: 46.22793192455733 , lon: -1.5106844902038574 } ,{ lat: 46.208452840524636 , lon: -1.4914584159851074 } ,{ lat: 46.21462988361741 , lon: -1.4694857597351076 } ,{ lat: 46.22840693784284 , lon: -1.4557528495788576 } ,{ lat: 46.22983195303529 , lon: -1.4124941825866701 } ,{ lat: 46.21843079560107 , lon: -1.4179873466491701 } ,{ lat: 46.21462988361741 , lon: -1.4379000663757326 } ,{ lat: 46.20370079617347 , lon: -1.4214205741882326 } ,{ lat: 46.20607686973418 , lon: -1.3637423515319826 } ,{ lat: 46.187540770464814 , lon: -1.3211703300476076 } ,{ lat: 46.187540770464814 , lon: -1.2902712821960451 } , { lat: 46.168522891339826, lon: -1.2799715995788576 }];
   const aunis =  [{ lat: 46.15614882302309 , lon: -1.24257659772411 } ,{ lat: 46.16566072406571 , lon: -1.2381134019233286 } ,{ lat: 46.16732513768052 , lon: -1.2281570420600474 } ,{ lat: 46.176597377351065 , lon: -1.2206039414741099 } ,{ lat: 46.18349110631067 , lon: -1.2140808091498914 } ,{ lat: 46.18563036369269 , lon: -1.2058410630561414 } ,{ lat: 46.193711251420396 , lon: -1.2006912217475474 } ,{ lat: 46.20060283448174 , lon: -1.1996612534858286 } ,{ lat: 46.20392949627321 , lon: -1.2058410630561414 } ,{ lat: 46.212957991479335 , lon: -1.1993179307319224 } ,{ lat: 46.21699657467677 , lon: -1.1893615708686411 } ,{ lat: 46.22127239787059 , lon: -1.1807785020209849 } ,{ lat: 46.22816052376446 , lon: -1.1663589463569226 } ,{ lat: 46.23576021140124 , lon: -1.1581192002631726 } ,{ lat: 46.240034573250306 , lon: -1.1464462266303599 } ,{ lat: 46.25333045860908 , lon: -1.1419830308295786 } ,{ lat: 46.26567375228429 , lon: -1.1231002793647349 } ,{ lat: 46.280387124710465 , lon: -1.1268768296577036 } ,{ lat: 46.297065412636506 , lon: -1.1312942497897895 } ,{ lat: 46.30690867491475 , lon: -1.1285476677585393 } ,{ lat: 46.31295606672611 , lon: -1.1232261650729924 } ,{ lat: 46.317224411607064 , lon: -1.1209945671726018 } ,{ lat: 46.321729525583414 , lon: -1.122196196811274 } ,{ lat: 46.3229150202417 , lon: -1.1179046623874456 } ,{ lat: 46.31734297199033 , lon: -1.1163597099948674 } ,{ lat: 46.31402318415763 , lon: -1.1057167046237737 } ,{ lat: 46.317248121533346 , lon: -1.08988952357322 } ,{ lat: 46.317248121533346 , lon: -1.074783322401345 } ,{ lat: 46.3272062939268 , lon: -1.07615661341697 } ,{ lat: 46.34853913139453 , lon: -1.05418395716697 } ,{ lat: 46.355648227748006 , lon: -1.0136718722060325 } ,{ lat: 46.35375255913759 , lon: -0.9965057345107199 } ,{ lat: 46.35138288090259 , lon: -0.9731597872450949 } ,{ lat: 46.36370408573634 , lon: -0.9635467501357199 } ,{ lat: 46.36038711158492 , lon: -0.9525604220107199 } ,{ lat: 46.36739990687648 , lon: -0.9425125108100476 } ,{ lat: 46.367163002857964 , lon: -0.9335861192084851 } ,{ lat: 46.37142711799261 , lon: -0.9274063096381725 } ,{ lat: 46.36313547734429 , lon: -0.9328994737006726 } ,{ lat: 46.35247294709819 , lon: -0.9380493150092664 } ,{ lat: 46.33683080577768 , lon: -0.9425125108100476 } ,{ lat: 46.32284389056306 , lon: -0.9631118760444225 } ,{ lat: 46.32023576501582 , lon: -0.9524688706733289 } ,{ lat: 46.31810175163659 , lon: -0.9435424790717664 } ,{ lat: 46.31501914093032 , lon: -0.9387359605170789 } ,{ lat: 46.31003917219136 , lon: -0.9304962144233287 } ,{ lat: 46.31549340003412 , lon: -0.92671966413036 } ,{ lat: 46.31264778375954 , lon: -0.9188232407905164 } ,{ lat: 46.316441905911304 , lon: -0.9147033677436414 } ,{ lat: 46.312410642391015 , lon: -0.9109268174506725 } ,{ lat: 46.314782009837145 , lon: -0.903373716864735 } ,{ lat: 46.31715327453017 , lon: -0.8958206162787975 } ,{ lat: 46.32236969516577 , lon: -0.8934173570014537 } ,{ lat: 46.32640022503428 , lon: -0.8872375474311412 } ,{ lat: 46.32379226902737 , lon: -0.87728118756786 } ,{ lat: 46.322606793378164 , lon: -0.867668150458485 } ,{ lat: 46.32758561848235 , lon: -0.8652648911811412 } ,{ lat: 46.32402936107468 , lon: -0.8604583726264537 } ,{ lat: 46.31833886834439 , lon: -0.8604583726264537 } ,{ lat: 46.31833886834439 , lon: -0.8494720445014537 } ,{ lat: 46.32545189178061 , lon: -0.8439788804389537 } ,{ lat: 46.3328010444841 , lon: -0.8480987534858287 } ,{ lat: 46.34228236311595 , lon: -0.831962584052235 } ,{ lat: 46.337304875819186 , lon: -0.8178863511420789 } ,{ lat: 46.34299339574021 , lon: -0.8024368272162975 } ,{ lat: 46.33849003294185 , lon: -0.7959136948920787 } ,{ lat: 46.334223347083395 , lon: -0.8065567002631725 } ,{ lat: 46.325688976635284 , lon: -0.8024368272162975 } ,{ lat: 46.32379226902737 , lon: -0.7914504990912975 } ,{ lat: 46.31833886834439 , lon: -0.7735977158881725 } ,{ lat: 46.312410642391015 , lon: -0.7681045518256725 } ,{ lat: 46.311936356571366 , lon: -0.7584915147162975 } ,{ lat: 46.30292414506747 , lon: -0.7485351548530162 } ,{ lat: 46.269518590985506 , lon: -0.7391967717558146 } ,{ lat: 46.25337793379174 , lon: -0.7474365178495647 } ,{ lat: 46.21823184233996 , lon: -0.6883850041776897 } ,{ lat: 46.20511754095409 , lon: -0.686393736395985 } ,{ lat: 46.19703833046367 , lon: -0.680900572333485 } ,{ lat: 46.19608775700568 , lon: -0.6939468369819226 } ,{ lat: 46.191572308523455 , lon: -0.6963500962592662 } ,{ lat: 46.19038397094372 , lon: -0.686393736395985 } ,{ lat: 46.18681880404533 , lon: -0.6942901597358287 } ,{ lat: 46.18301570447624 , lon: -0.6901702866889537 } ,{ lat: 46.18446566867017 , lon: -0.6804656982421876 } ,{ lat: 46.18529759724047 , lon: -0.6691360473632812 } ,{ lat: 46.18006812279714 , lon: -0.6608963012695312 } ,{ lat: 46.17531362346998 , lon: -0.6566047668457032 } ,{ lat: 46.17210410402465 , lon: -0.6554031372070314 } ,{ lat: 46.16473338751506 , lon: -0.6413269042968751 } ,{ lat: 46.164614496897094 , lon: -0.6270790100097656 } ,{ lat: 46.16092876029723 , lon: -0.6279373168945314 } ,{ lat: 46.1618799417681 , lon: -0.6102561950683595 } ,{ lat: 46.156410423742486 , lon: -0.6009864807128907 } ,{ lat: 46.152724137540936 , lon: -0.6071662902832032 } ,{ lat: 46.15379437510151 , lon: -0.6241607666015626 } ,{ lat: 46.150702520919346 , lon: -0.6337738037109376 } ,{ lat: 46.148561904734926 , lon: -0.6330871582031251 } ,{ lat: 46.14665906490367 , lon: -0.6265640258789064 } ,{ lat: 46.141425916196326 , lon: -0.6279373168945314 } ,{ lat: 46.13916599365226 , lon: -0.6210708618164064 } ,{ lat: 46.136311222062865 , lon: -0.6160926818847657 } ,{ lat: 46.141901677543785 , lon: -0.6126594543457031 } ,{ lat: 46.14356680988437 , lon: -0.5992698669433595 } ,{ lat: 46.13940388460399 , lon: -0.5826187133789064 } ,{ lat: 46.120845303856164 , lon: -0.5838203430175782 } ,{ lat: 46.11418172394165 , lon: -0.5659675598144532 } ,{ lat: 46.10477994632608 , lon: -0.5747222900390626 } ,{ lat: 46.106327184524474 , lon: -0.5863952636718751 } ,{ lat: 46.113229718172505 , lon: -0.5942916870117189 } ,{ lat: 46.1077553658556 , lon: -0.6148910522460939 } ,{ lat: 46.10668423332623 , lon: -0.6308555603027345 } ,{ lat: 46.09989991062732 , lon: -0.631542205810547 } ,{ lat: 46.10085214663405 , lon: -0.6540298461914064 } ,{ lat: 46.07751763011812 , lon: -0.6766891479492189 } ,{ lat: 46.0653702518009 , lon: -0.6473350524902345 } ,{ lat: 46.06346453810827 , lon: -0.6632995605468751 } ,{ lat: 46.05727051427208 , lon: -0.6667327880859376 } ,{ lat: 46.04821646025904 , lon: -0.6634712219238282 } ,{ lat: 46.04237819106182 , lon: -0.6801223754882814 } ,{ lat: 46.02938880791639 , lon: -0.6787490844726562 } ,{ lat: 46.020926191426476 , lon: -0.6813240051269532 } ,{ lat: 46.02033018369074 , lon: -0.7010650634765626 } ,{ lat: 46.02021098137262 , lon: -0.7108497619628907 } ,{ lat: 46.02223738582996 , lon: -0.715312957763672 } ,{ lat: 46.01925735357603 , lon: -0.719432830810547 } ,{ lat: 46.01389289075796 , lon: -0.7206344604492189 } ,{ lat: 46.00542790223731 , lon: -0.7130813598632812 } ,{ lat: 46.003639358619395 , lon: -0.7075881958007812 } ,{ lat: 45.9983926304258 , lon: -0.7103347778320314 } ,{ lat: 45.988613309322986 , lon: -0.7161712646484376 } ,{ lat: 45.980025163544795 , lon: -0.716686248779297 } ,{ lat: 45.9828880268373 , lon: -0.7299041748046876 } ,{ lat: 45.98074089324607 , lon: -0.7463836669921875 } ,{ lat: 45.983007309595294 , lon: -0.7616615295410157 } ,{ lat: 45.9794287150595 , lon: -0.7690429687500001 } ,{ lat: 45.97477619636484 , lon: -0.8006286621093751 } ,{ lat: 45.964515414762964 , lon: -0.8727264404296876 } ,{ lat: 46.0124622794485 , lon: -0.8476638793945314 } ,{ lat: 46.018780533509954 , lon: -0.8586502075195314 } ,{ lat: 45.98646639778119 , lon: -0.8950424194335939 } ,{ lat: 45.99624609821495 , lon: -0.9520339965820312 } ,{ lat: 46.003162403888766 , lon: -1.0073089599609377 } ,{ lat: 46.00373474761652 , lon: -1.0482559190131726 } ,{ lat: 46.02543180056944 , lon: -1.0606155381537974 } ,{ lat: 46.04959848789755 , lon: -1.063796994276345 } ,{ lat: 46.05436384527023 , lon: -1.08714294154197 } ,{ lat: 46.064846184185576 , lon: -1.094009396620095 } ,{ lat: 46.09532894596422 , lon: -1.10087585169822 } ,{ lat: 46.10294700505424 , lon: -1.12834167201072 } ,{ lat: 46.107707757501764 , lon: -1.1413879366591575 } ,{ lat: 46.115800093101875 , lon: -1.124221798963845 } ,{ lat: 46.12631835596506 , lon: -1.1292800889350476 } ,{ lat: 46.12869777424802 , lon: -1.1464462266303599 } ,{ lat: 46.13750072821168 , lon: -1.1564025864936411 } ,{ lat: 46.138690208665395 , lon: -1.172538755927235 } ,{ lat: 46.14654013523015 , lon: -1.1728820786811414 } ,{ lat: 46.142080086989175 , lon: -1.1700668331468478 } ,{ lat: 46.14249637344679 , lon: -1.1672344204271212 } ,{ lat: 46.14410202029837 , lon: -1.1675777431810275 } ,{ lat: 46.14499402609231 , lon: -1.1663761135423558 } ,{ lat: 46.14255584268377 , lon: -1.1656894680345433 } ,{ lat: 46.14202061723829 , lon: -1.163801192888059 } ,{ lat: 46.15171333851232 , lon: -1.1599388119066134 } ,{ lat: 46.15432948607707 , lon: -1.1529006954515355 } ,{ lat: 46.15748058961549 , lon: -1.1510982509935277 } ,{ lat: 46.15777785422001 , lon: -1.1529865261400118 } ,{ lat: 46.15528078163087 , lon: -1.1547889705980197 } ,{ lat: 46.15432948607707 , lon: -1.1575355526292699 } ,{ lat: 46.15450785524603 , lon: -1.1600246425950902 } ,{ lat: 46.15566724075234 , lon: -1.1633763312420344 } ,{ lat: 46.15266467928845 , lon: -1.174358367570676 } ,{ lat: 46.153675460844774 , lon: -1.1859283433295789 } ,{ lat: 46.15147550074883 , lon: -1.1873188015306368 } ,{ lat: 46.1471347810282 , lon: -1.2000217434251683 } ,{ lat: 46.14612387934942 , lon: -1.2056007381761447 } ,{ lat: 46.14832405335329 , lon: -1.210664748796262 } ,{ lat: 46.147075316737485 , lon: -1.2132396694505587 } ,{ lat: 46.14766995675421 , lon: -1.2156429287279027 } ,{ lat: 46.1477294204026 , lon: -1.2271442409837618 } ,{ lat: 46.152724137540936 , lon: -1.2305603013373911 }];
  return (
    <MapContainer
      ref={mapRef}
      center={position}
      zoom={11}
      className={styles.mapContainer}
      whenCreated={setMap}
      zoomControl={false}
      tap={false}
    >
      <TileLayer
        attribution='&amp;copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
      />
      <ZoomControl position="topright" />
      {children}
      <Polygon color="green" positions={re}   className={styles.polygon}/>
      <Polygon color="green" positions={aunis}  className={styles.polygon}/>
    </MapContainer>
  );
};

export default Map;
