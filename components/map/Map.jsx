import React, { useRef, useState, useEffect } from 'react';
import makeStyles from '@mui/styles/makeStyles';
import {
  MapContainer, TileLayer, Marker, Popup, Tooltip, ZoomControl,Polygon
} from 'react-leaflet';
import L from 'leaflet';
import 'leaflet.markercluster';
import 'leaflet/dist/leaflet.css';

L.Icon.Default.mergeOptions({
  iconUrl: null,
});


const useStyles = makeStyles((theme) => ({
  polygon:{
    cursor: 'grab',
  }
}));

const Map = (props) => {
  const mapRef = useRef();
  const styles = useStyles();
  const [map, setMap] = useState(null);
  let { children,position,scrollWheelZoom,classMap } = props;
  //debugger;
  if (typeof position === 'undefined'){
    position = [46.1085193, -0.9864794];
  }

  useEffect(() => {
    if (map) {
      setInterval(() => {
        try {
          if (map) {
            map.invalidateSize();
          }
        } catch (error) {
        }
      }, 100);
    }
  }, [map]);
  const pathOptions = { color: 'green' ,fill :false}
  const re = [{ lat: 46.16012618814026 , lon: -1.274371147155762 } ,{ lat: 46.15997756238203 , lon: -1.2688350677490237 } ,{ lat: 46.16125573078264 , lon: -1.2632131576538088 } ,{ lat: 46.16300944840648 , lon: -1.2596511840820315 } ,{ lat: 46.16509005782732 , lon: -1.2552738189697268 } ,{ lat: 46.1622069066008 , lon: -1.254072189331055 } ,{ lat: 46.158491282718735 , lon: -1.262011528015137 } ,{ lat: 46.154567311507186 , lon: -1.2696075439453127 } ,{ lat: 46.150345757336574 , lon: -1.2750148773193362 } ,{ lat: 46.143975651642066 , lon: -1.2792527675628664 } ,{ lat: 46.14576708608925 , lon: -1.2876319885253906 } ,{ lat: 46.143328936919104 , lon: -1.3055706024169924 } ,{ lat: 46.14410202029837 , lon: -1.314668655395508 } ,{ lat: 46.145588688591985 , lon: -1.3229942321777346 } ,{ lat: 46.15147550074883 , lon: -1.3387012481689453 } ,{ lat: 46.1560536971598 , lon: -1.3540649414062502 } ,{ lat: 46.16538728132106 , lon: -1.3685703277587893 } ,{ lat: 46.17608625758462 , lon: -1.3897705078125002 } ,{ lat: 46.182504644370056 , lon: -1.4077091217041018 } ,{ lat: 46.18868460501477 , lon: -1.4236736297607424 } ,{ lat: 46.19040773939773 , lon: -1.4318275451660158 } ,{ lat: 46.20032956547517 , lon: -1.456718444824219 } ,{ lat: 46.20312161266488 , lon: -1.470623016357422 } ,{ lat: 46.20098303604598 , lon: -1.4844417572021484 } ,{ lat: 46.19599270020596 , lon: -1.4950847625732422 } ,{ lat: 46.19391325984221 , lon: -1.5064144134521487 } ,{ lat: 46.2004483788843 , lon: -1.5195465087890627 } ,{ lat: 46.202750337973434 , lon: -1.5360903739929201 } ,{ lat: 46.220049072800265 , lon: -1.5446949005126955 } ,{ lat: 46.23311231614402 , lon: -1.55756950378418 } ,{ lat: 46.245504678433946 , lon: -1.5635561943054201 } ,{ lat: 46.243441952422 , lon: -1.5476131439208987 } ,{ lat: 46.24356067256931 , lon: -1.539287567138672 } ,{ lat: 46.246884732388224 , lon: -1.5313053131103518 } ,{ lat: 46.25092081995666 , lon: -1.524009704589844 } ,{ lat: 46.257849733512 , lon: -1.5134310722351076 } ,{ lat: 46.2570930853206 , lon: -1.504955291748047 } ,{ lat: 46.25798325857959 , lon: -1.5004920959472658 } ,{ lat: 46.256321590140196 , lon: -1.494741439819336 } ,{ lat: 46.25460052331615 , lon: -1.492767333984375 } ,{ lat: 46.25371029514335 , lon: -1.489677429199219 } ,{ lat: 46.249496352373946 , lon: -1.487531661987305 } ,{ lat: 46.24789378212289 , lon: -1.483154296875 } ,{ lat: 46.24403555058946 , lon: -1.482038497924805 } ,{ lat: 46.2401770476936 , lon: -1.4816951751708987 } ,{ lat: 46.236437008995864 , lon: -1.476116180419922 } ,{ lat: 46.23311231614402 , lon: -1.4736270904541018 } ,{ lat: 46.230440541999506 , lon: -1.4799785614013674 } ,{ lat: 46.229015542607435 , lon: -1.4807510375976565 } ,{ lat: 46.22943117125174 , lon: -1.4920806884765625 } ,{ lat: 46.23495279600417 , lon: -1.495170593261719 } ,{ lat: 46.23168738611932 , lon: -1.5010929107666018 } ,{ lat: 46.226699839689665 , lon: -1.5079593658447266 } ,{ lat: 46.23453720917292 , lon: -1.5147399902343752 } ,{ lat: 46.22301826471777 , lon: -1.5133666992187502 } ,{ lat: 46.21607010388079 , lon: -1.5053844451904297 } ,{ lat: 46.216367051815546 , lon: -1.4998054504394533 } ,{ lat: 46.212981750169504 , lon: -1.4935398101806643 } ,{ lat: 46.21084355739712 , lon: -1.4941406250000002 } ,{ lat: 46.20929925529135 , lon: -1.4957714080810547 } ,{ lat: 46.207101519740945 , lon: -1.4919948577880862 } ,{ lat: 46.20775490976533 , lon: -1.489419937133789 } ,{ lat: 46.20389385598612 , lon: -1.487531661987305 } ,{ lat: 46.20739851617005 , lon: -1.4848709106445315 } ,{ lat: 46.209715033206564 , lon: -1.4827251434326174 } ,{ lat: 46.210665370908586 , lon: -1.4804935455322266 } ,{ lat: 46.21250660341393 , lon: -1.4824676513671875 } ,{ lat: 46.214882296084085 , lon: -1.4786052703857424 } ,{ lat: 46.21462988361741 , lon: -1.4694857597351076 } ,{ lat: 46.22307764691826 , lon: -1.4654731750488283 } ,{ lat: 46.22402775339081 , lon: -1.458091735839844 } ,{ lat: 46.22840693784284 , lon: -1.4557528495788576 } ,{ lat: 46.22913429396983 , lon: -1.4446163177490237 } ,{ lat: 46.23026241909871 , lon: -1.4270210266113283 } ,{ lat: 46.229490546515464 , lon: -1.4116573333740237 } ,{ lat: 46.227709260664696 , lon: -1.4109706878662112 } ,{ lat: 46.22735299655779 , lon: -1.4146614074707033 } ,{ lat: 46.226046675049744 , lon: -1.4173221588134768 } ,{ lat: 46.22266197016603 , lon: -1.417837142944336 } ,{ lat: 46.21951460120204 , lon: -1.4194679260253906 } ,{ lat: 46.21737666278269 , lon: -1.4299392700195315 } ,{ lat: 46.21713910893101 , lon: -1.4371490478515627 } ,{ lat: 46.214525948735115 , lon: -1.4387798309326172 } ,{ lat: 46.20977442979466 , lon: -1.435346603393555 } ,{ lat: 46.20370079617347 , lon: -1.4214205741882326 } ,{ lat: 46.20359684060874 , lon: -1.3933753967285156 } ,{ lat: 46.205378908786145 , lon: -1.3786983489990234 } ,{ lat: 46.20751731429206 , lon: -1.3652229309082033 } ,{ lat: 46.20632932151025 , lon: -1.3599014282226562 } ,{ lat: 46.205854117203614 , lon: -1.3550090789794924 } ,{ lat: 46.2044878819235 , lon: -1.35432243347168 } ,{ lat: 46.20312161266488 , lon: -1.3502025604248047 } ,{ lat: 46.200270158674236 , lon: -1.3419628143310547 } ,{ lat: 46.197121506309365 , lon: -1.337242126464844 } ,{ lat: 46.187540770464814 , lon: -1.3211703300476076 } ,{ lat: 46.18993239737729 , lon: -1.3072013854980469 } ,{ lat: 46.186486044787195 , lon: -1.291923522949219 } ,{ lat: 46.181018973330886 , lon: -1.2872886657714846 } ,{ lat: 46.178166372398046 , lon: -1.2883186340332031 } ,{ lat: 46.17537305724884 , lon: -1.28690242767334 } ,{ lat: 46.17103422258557 , lon: -1.2823963165283205 } ,{ lat: 46.16773529046691 , lon: -1.2826967239379885 } ,{ lat: 46.16425782350158 , lon: -1.2810230255126953 }];
         const aunis =  [{ lat: 46.15614882302309 , lon: -1.24257659772411 } ,{ lat: 46.16566072406571 , lon: -1.2381134019233286 } ,{ lat: 46.16732513768052 , lon: -1.2281570420600474 } ,{ lat: 46.176597377351065 , lon: -1.2206039414741099 } ,{ lat: 46.18349110631067 , lon: -1.2140808091498914 } ,{ lat: 46.18563036369269 , lon: -1.2058410630561414 } ,{ lat: 46.193711251420396 , lon: -1.2006912217475474 } ,{ lat: 46.20060283448174 , lon: -1.1996612534858286 } ,{ lat: 46.20392949627321 , lon: -1.2058410630561414 } ,{ lat: 46.212957991479335 , lon: -1.1993179307319224 } ,{ lat: 46.21699657467677 , lon: -1.1893615708686411 } ,{ lat: 46.22127239787059 , lon: -1.1807785020209849 } ,{ lat: 46.22816052376446 , lon: -1.1663589463569226 } ,{ lat: 46.23576021140124 , lon: -1.1581192002631726 } ,{ lat: 46.240034573250306 , lon: -1.1464462266303599 } ,{ lat: 46.25333045860908 , lon: -1.1419830308295786 } ,{ lat: 46.26567375228429 , lon: -1.1231002793647349 } ,{ lat: 46.280387124710465 , lon: -1.1268768296577036 } ,{ lat: 46.297065412636506 , lon: -1.1312942497897895 } ,{ lat: 46.30690867491475 , lon: -1.1285476677585393 } ,{ lat: 46.31295606672611 , lon: -1.1232261650729924 } ,{ lat: 46.317224411607064 , lon: -1.1209945671726018 } ,{ lat: 46.321729525583414 , lon: -1.122196196811274 } ,{ lat: 46.3229150202417 , lon: -1.1179046623874456 } ,{ lat: 46.31734297199033 , lon: -1.1163597099948674 } ,{ lat: 46.31402318415763 , lon: -1.1057167046237737 } ,{ lat: 46.317248121533346 , lon: -1.08988952357322 } ,{ lat: 46.317248121533346 , lon: -1.074783322401345 } ,{ lat: 46.3272062939268 , lon: -1.07615661341697 } ,{ lat: 46.34853913139453 , lon: -1.05418395716697 } ,{ lat: 46.355648227748006 , lon: -1.0136718722060325 } ,{ lat: 46.35375255913759 , lon: -0.9965057345107199 } ,{ lat: 46.35138288090259 , lon: -0.9731597872450949 } ,{ lat: 46.36370408573634 , lon: -0.9635467501357199 } ,{ lat: 46.36038711158492 , lon: -0.9525604220107199 } ,{ lat: 46.36739990687648 , lon: -0.9425125108100476 } ,{ lat: 46.367163002857964 , lon: -0.9335861192084851 } ,{ lat: 46.37142711799261 , lon: -0.9274063096381725 } ,{ lat: 46.36313547734429 , lon: -0.9328994737006726 } ,{ lat: 46.35247294709819 , lon: -0.9380493150092664 } ,{ lat: 46.33683080577768 , lon: -0.9425125108100476 } ,{ lat: 46.32284389056306 , lon: -0.9631118760444225 } ,{ lat: 46.32023576501582 , lon: -0.9524688706733289 } ,{ lat: 46.31810175163659 , lon: -0.9435424790717664 } ,{ lat: 46.31501914093032 , lon: -0.9387359605170789 } ,{ lat: 46.31003917219136 , lon: -0.9304962144233287 } ,{ lat: 46.31549340003412 , lon: -0.92671966413036 } ,{ lat: 46.31264778375954 , lon: -0.9188232407905164 } ,{ lat: 46.316441905911304 , lon: -0.9147033677436414 } ,{ lat: 46.312410642391015 , lon: -0.9109268174506725 } ,{ lat: 46.314782009837145 , lon: -0.903373716864735 } ,{ lat: 46.31715327453017 , lon: -0.8958206162787975 } ,{ lat: 46.32236969516577 , lon: -0.8934173570014537 } ,{ lat: 46.32640022503428 , lon: -0.8872375474311412 } ,{ lat: 46.32379226902737 , lon: -0.87728118756786 } ,{ lat: 46.322606793378164 , lon: -0.867668150458485 } ,{ lat: 46.32758561848235 , lon: -0.8652648911811412 } ,{ lat: 46.32402936107468 , lon: -0.8604583726264537 } ,{ lat: 46.31833886834439 , lon: -0.8604583726264537 } ,{ lat: 46.31833886834439 , lon: -0.8494720445014537 } ,{ lat: 46.32545189178061 , lon: -0.8439788804389537 } ,{ lat: 46.3328010444841 , lon: -0.8480987534858287 } ,{ lat: 46.34228236311595 , lon: -0.831962584052235 } ,{ lat: 46.337304875819186 , lon: -0.8178863511420789 } ,{ lat: 46.34299339574021 , lon: -0.8024368272162975 } ,{ lat: 46.33849003294185 , lon: -0.7959136948920787 } ,{ lat: 46.334223347083395 , lon: -0.8065567002631725 } ,{ lat: 46.325688976635284 , lon: -0.8024368272162975 } ,{ lat: 46.32379226902737 , lon: -0.7914504990912975 } ,{ lat: 46.31833886834439 , lon: -0.7735977158881725 } ,{ lat: 46.312410642391015 , lon: -0.7681045518256725 } ,{ lat: 46.311936356571366 , lon: -0.7584915147162975 } ,{ lat: 46.30292414506747 , lon: -0.7485351548530162 } ,{ lat: 46.269518590985506 , lon: -0.7391967717558146 } ,{ lat: 46.25337793379174 , lon: -0.7474365178495647 } ,{ lat: 46.21823184233996 , lon: -0.6883850041776897 } ,{ lat: 46.20511754095409 , lon: -0.686393736395985 } ,{ lat: 46.19703833046367 , lon: -0.680900572333485 } ,{ lat: 46.19608775700568 , lon: -0.6939468369819226 } ,{ lat: 46.191572308523455 , lon: -0.6963500962592662 } ,{ lat: 46.19038397094372 , lon: -0.686393736395985 } ,{ lat: 46.18681880404533 , lon: -0.6942901597358287 } ,{ lat: 46.18301570447624 , lon: -0.6901702866889537 } ,{ lat: 46.18446566867017 , lon: -0.6804656982421876 } ,{ lat: 46.18529759724047 , lon: -0.6691360473632812 } ,{ lat: 46.18006812279714 , lon: -0.6608963012695312 } ,{ lat: 46.17531362346998 , lon: -0.6566047668457032 } ,{ lat: 46.17210410402465 , lon: -0.6554031372070314 } ,{ lat: 46.16473338751506 , lon: -0.6413269042968751 } ,{ lat: 46.164614496897094 , lon: -0.6270790100097656 } ,{ lat: 46.16092876029723 , lon: -0.6279373168945314 } ,{ lat: 46.1618799417681 , lon: -0.6102561950683595 } ,{ lat: 46.156410423742486 , lon: -0.6009864807128907 } ,{ lat: 46.152724137540936 , lon: -0.6071662902832032 } ,{ lat: 46.15379437510151 , lon: -0.6241607666015626 } ,{ lat: 46.150702520919346 , lon: -0.6337738037109376 } ,{ lat: 46.148561904734926 , lon: -0.6330871582031251 } ,{ lat: 46.14665906490367 , lon: -0.6265640258789064 } ,{ lat: 46.141425916196326 , lon: -0.6279373168945314 } ,{ lat: 46.13916599365226 , lon: -0.6210708618164064 } ,{ lat: 46.136311222062865 , lon: -0.6160926818847657 } ,{ lat: 46.141901677543785 , lon: -0.6126594543457031 } ,{ lat: 46.14356680988437 , lon: -0.5992698669433595 } ,{ lat: 46.13940388460399 , lon: -0.5826187133789064 } ,{ lat: 46.120845303856164 , lon: -0.5838203430175782 } ,{ lat: 46.11418172394165 , lon: -0.5659675598144532 } ,{ lat: 46.10477994632608 , lon: -0.5747222900390626 } ,{ lat: 46.106327184524474 , lon: -0.5863952636718751 } ,{ lat: 46.113229718172505 , lon: -0.5942916870117189 } ,{ lat: 46.1077553658556 , lon: -0.6148910522460939 } ,{ lat: 46.10668423332623 , lon: -0.6308555603027345 } ,{ lat: 46.09989991062732 , lon: -0.631542205810547 } ,{ lat: 46.10085214663405 , lon: -0.6540298461914064 } ,{ lat: 46.07751763011812 , lon: -0.6766891479492189 } ,{ lat: 46.0653702518009 , lon: -0.6473350524902345 } ,{ lat: 46.06346453810827 , lon: -0.6632995605468751 } ,{ lat: 46.05727051427208 , lon: -0.6667327880859376 } ,{ lat: 46.04821646025904 , lon: -0.6634712219238282 } ,{ lat: 46.04237819106182 , lon: -0.6801223754882814 } ,{ lat: 46.02938880791639 , lon: -0.6787490844726562 } ,{ lat: 46.020926191426476 , lon: -0.6813240051269532 } ,{ lat: 46.02033018369074 , lon: -0.7010650634765626 } ,{ lat: 46.02021098137262 , lon: -0.7108497619628907 } ,{ lat: 46.02223738582996 , lon: -0.715312957763672 } ,{ lat: 46.01925735357603 , lon: -0.719432830810547 } ,{ lat: 46.01389289075796 , lon: -0.7206344604492189 } ,{ lat: 46.00542790223731 , lon: -0.7130813598632812 } ,{ lat: 46.003639358619395 , lon: -0.7075881958007812 } ,{ lat: 45.9983926304258 , lon: -0.7103347778320314 } ,{ lat: 45.988613309322986 , lon: -0.7161712646484376 } ,{ lat: 45.980025163544795 , lon: -0.716686248779297 } ,{ lat: 45.9828880268373 , lon: -0.7299041748046876 } ,{ lat: 45.98074089324607 , lon: -0.7463836669921875 } ,{ lat: 45.983007309595294 , lon: -0.7616615295410157 } ,{ lat: 45.9794287150595 , lon: -0.7690429687500001 } ,{ lat: 45.97477619636484 , lon: -0.8006286621093751 } ,{ lat: 45.964515414762964 , lon: -0.8727264404296876 } ,{ lat: 46.0124622794485 , lon: -0.8476638793945314 } ,{ lat: 46.018780533509954 , lon: -0.8586502075195314 } ,{ lat: 45.98646639778119 , lon: -0.8950424194335939 } ,{ lat: 45.99624609821495 , lon: -0.9520339965820312 } ,{ lat: 46.003162403888766 , lon: -1.0073089599609377 } ,{ lat: 46.00373474761652 , lon: -1.0482559190131726 } ,{ lat: 46.02543180056944 , lon: -1.0606155381537974 } ,{ lat: 46.04959848789755 , lon: -1.063796994276345 } ,{ lat: 46.05436384527023 , lon: -1.08714294154197 } ,{ lat: 46.064846184185576 , lon: -1.094009396620095 } ,{ lat: 46.09532894596422 , lon: -1.10087585169822 } ,{ lat: 46.10294700505424 , lon: -1.12834167201072 } ,{ lat: 46.107707757501764 , lon: -1.1413879366591575 } ,{ lat: 46.115800093101875 , lon: -1.124221798963845 } ,{ lat: 46.12631835596506 , lon: -1.1292800889350476 } ,{ lat: 46.12869777424802 , lon: -1.1464462266303599 } ,{ lat: 46.13750072821168 , lon: -1.1564025864936411 } ,{ lat: 46.138690208665395 , lon: -1.172538755927235 } ,{ lat: 46.14654013523015 , lon: -1.1728820786811414 } ,{ lat: 46.142080086989175 , lon: -1.1700668331468478 } ,{ lat: 46.14249637344679 , lon: -1.1672344204271212 } ,{ lat: 46.14410202029837 , lon: -1.1675777431810275 } ,{ lat: 46.14499402609231 , lon: -1.1663761135423558 } ,{ lat: 46.14255584268377 , lon: -1.1656894680345433 } ,{ lat: 46.14202061723829 , lon: -1.163801192888059 } ,{ lat: 46.15171333851232 , lon: -1.1599388119066134 } ,{ lat: 46.15432948607707 , lon: -1.1529006954515355 } ,{ lat: 46.15748058961549 , lon: -1.1510982509935277 } ,{ lat: 46.15777785422001 , lon: -1.1529865261400118 } ,{ lat: 46.15528078163087 , lon: -1.1547889705980197 } ,{ lat: 46.15432948607707 , lon: -1.1575355526292699 } ,{ lat: 46.15450785524603 , lon: -1.1600246425950902 } ,{ lat: 46.15566724075234 , lon: -1.1633763312420344 } ,{ lat: 46.15266467928845 , lon: -1.174358367570676 } ,{ lat: 46.153675460844774 , lon: -1.1859283433295789 } ,{ lat: 46.15147550074883 , lon: -1.1873188015306368 } ,{ lat: 46.1471347810282 , lon: -1.2000217434251683 } ,{ lat: 46.14612387934942 , lon: -1.2056007381761447 } ,{ lat: 46.14832405335329 , lon: -1.210664748796262 } ,{ lat: 46.147075316737485 , lon: -1.2132396694505587 } ,{ lat: 46.14766995675421 , lon: -1.2156429287279027 } ,{ lat: 46.1477294204026 , lon: -1.2271442409837618 } ,{ lat: 46.152724137540936 , lon: -1.2305603013373911 }];
  return (
    <MapContainer
      ref={mapRef}
      center={position}
      zoom={11}
      className={classMap} 
      whenCreated={setMap}
      scrollWheelZoom={scrollWheelZoom}
      zoomControl={false}
      tap={false}
    >
      <TileLayer
        attribution='&amp;copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
      />
      <ZoomControl position="topright" />
      {children}
      <Polygon  pathOptions={pathOptions}  positions={re}   className={styles.polygon}/>
      <Polygon pathOptions={pathOptions}  positions={aunis}  className={styles.polygon}/>
    </MapContainer>
  );
};

export default Map;
